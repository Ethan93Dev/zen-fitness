generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum USERROLE {
  NOTMEMBER
  MEMBER
  TRAINER
}

model User {
  id           Int           @id @default(autoincrement())
  username     String
  email        String        @unique
  password     String
  isOnline     Boolean       @default(false)
  createdAt    DateTime      @default(now())
  profile      Profile?
  visits       Visits[]
  profileId    Int?
  userWorkouts UserWorkout[]
  userTrainers UserTrainer[]
}

model Profile {
  id          Int      @id @default(autoincrement())
  firstname   String
  lastname    String
  address     String
  userId      Int      @unique
  city        String
  state       String
  phone       Int
  memberSince DateTime @default(now())
  userrole    USERROLE @default(NOTMEMBER)
  user        User     @relation(fields: [userId], references: [id])
}

model Visits {
  id           Int           @id @default(autoincrement())
  userId       Int
  checkin      DateTime
  checkout     DateTime?
  user         User          @relation(fields: [userId], references: [id])
  userWorkouts UserWorkout[] @relation("WorkoutToUserWorkout")
}

model UserWorkout {
  id                Int                 @id @default(autoincrement())
  userId            Int
  editedAt          DateTime            @default(now())
  workout           String
  user              User                @relation(fields: [userId], references: [id])
  favoritedExercise FavoritedExercise[] @relation("UserWorkoutFavoritedExercises")
  visits            Visits[]            @relation("WorkoutToUserWorkout")
}

model FavoritedExercise {
  id               Int           @id @default(autoincrement())
  name             String        @unique
  equipment        String
  gifUrl           String
  target           String
  bodyPart         String
  instructions     String[]
  secondaryMuscles String[]
  userWorkouts     UserWorkout[] @relation("UserWorkoutFavoritedExercises")
}

enum RoleType {
  ADMIN
  MANAGER
  TRAINER
  EMPLOYEE
}

model Employee {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String
  role      RoleType @default(EMPLOYEE)
  bio       String?
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())

  userTrainers UserTrainer[]
  trainer      Trainer?      @relation("EmployeeTrainer")
}

model Trainer {
  id         Int     @id @default(autoincrement())
  employeeId Int     @unique
  bio        String?
  isActive   Boolean @default(false)

  employee Employee      @relation("EmployeeTrainer", fields: [employeeId], references: [id])
  users    UserTrainer[]
}

model UserTrainer {
  id        Int @id @default(autoincrement())
  userId    Int
  trainerId Int

  user       User      @relation(fields: [userId], references: [id])
  trainer    Trainer   @relation(fields: [trainerId], references: [id])
  employee   Employee? @relation(fields: [employeeId], references: [id])
  employeeId Int?

  @@unique([userId, trainerId])
}
